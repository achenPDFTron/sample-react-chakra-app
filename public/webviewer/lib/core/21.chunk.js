/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[21],{537:function(wa,sa,n){n.r(sa);var pa=n(0),na=n(7),oa=n(3);wa=n(51);var ja=n(29),ia=n(13);n=function(){function fa(){this.init()}fa.prototype.init=function(){this.bha=!1;this.Qf=this.sn=this.connection=null;this.Iu={};this.ga=this.VJ=null};fa.prototype.rBa=function(y){for(var x=this,e=0;e<y.length;++e){var f=y[e];switch(f.at){case "create":this.Iu[f.author]||(this.Iu[f.author]=f.aName);this.qqa(f);break;case "modify":this.ga.pq(f.xfdf).then(function(a){x.ga.qb(a[0])});
break;case "delete":this.ga.pq("<delete><id>"+f.aId+"</id></delete>")}}};fa.prototype.qqa=function(y){var x=this;this.ga.pq(y.xfdf).then(function(e){e=e[0];e.authorId=y.author;x.ga.qb(e);x.ga.trigger(na.c.UPDATE_ANNOTATION_PERMISSION,[e])})};fa.prototype.Npa=function(y,x,e){this.sn&&this.sn(y,x,e)};fa.prototype.preloadAnnotations=function(y){this.addEventListener("webViewerServerAnnotationsEnabled",this.Npa.bind(this,y,"add",{imported:!1}),{once:!0})};fa.prototype.initiateCollaboration=function(y,
x,e){var f=this;if(y){f.Qf=x;f.ga=e.la();e.addEventListener(na.h.DOCUMENT_UNLOADED,function(){f.disableCollaboration()});f.VBa(y);var a=new XMLHttpRequest;a.addEventListener("load",function(){if(200===a.status&&0<a.responseText.length)try{var b=JSON.parse(a.responseText);f.connection=exports.da.ICa(Object(ja.k)(f.Qf,"blackbox/"),"annot");f.VJ=b.id;f.Iu[b.id]=b.user_name;f.ga.vS(b.id);f.connection.iGa(function(h){h.t&&h.t.startsWith("a_")&&h.data&&f.rBa(h.data)},function(){f.connection.send({t:"a_retrieve",
dId:y});f.trigger(fa.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[f.Iu[b.id],f.VJ])},function(){f.disableCollaboration()})}catch(h){Object(oa.g)(h.message)}});a.open("GET",Object(ja.k)(this.Qf,"demo/SessionInfo.jsp"));a.withCredentials=!0;a.send();f.bha=!0;f.ga.s7(function(b){return f.Iu[b.Author]||b.Author})}else Object(oa.g)("Document ID required for collaboration")};fa.prototype.disableCollaboration=function(){this.sn&&(this.ga.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.sn),this.sn=
null);this.connection&&this.connection.bs();this.ga&&this.ga.vS("Guest");this.init();this.trigger(fa.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};fa.prototype.VBa=function(y){var x=this;this.sn&&this.ga.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.sn);this.sn=function(e,f,a){return Object(pa.b)(this,void 0,void 0,function(){var b,h,r,w,z,aa,ha,ba,ca;return Object(pa.d)(this,function(ea){switch(ea.label){case 0:if(a.imported)return[2];b={t:"a_"+f,dId:y,annots:[]};return[4,x.ga.v_()];case 1:h=
ea.ba();"delete"!==f&&(r=(new DOMParser).parseFromString(h,"text/xml"),w=new XMLSerializer);for(z=0;z<e.length;z++)aa=e[z],ba=ha=void 0,"add"===f?(ha=r.querySelector('[name="'+aa.Id+'"]'),ba=w.serializeToString(ha),ca=null,aa.InReplyTo&&(ca=x.ga.hg(aa.InReplyTo).authorId||"default"),b.annots.push({at:"create",aId:aa.Id,author:x.VJ,aName:x.Iu[x.VJ],parent:ca,xfdf:"<add>"+ba+"</add>"})):"modify"===f?(ha=r.querySelector('[name="'+aa.Id+'"]'),ba=w.serializeToString(ha),b.annots.push({at:"modify",aId:aa.Id,
xfdf:"<modify>"+ba+"</modify>"})):"delete"===f&&b.annots.push({at:"delete",aId:aa.Id});0<b.annots.length&&x.connection.send(b);return[2]}})})}.bind(x);this.ga.addEventListener(ia.a.Events.ANNOTATION_CHANGED,this.sn)};fa.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return fa}();Object(wa.a)(n);sa["default"]=n}}]);}).call(this || window)
